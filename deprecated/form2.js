const player_names_with_full_stops = `Fábio Vieira,G.Jesus,Gabriel,Havertz,Hein,J.Timber,Jorginho,Kiwior,Martinelli,Nwaneri,Ødegaard,Raya,Rice,Saka,Saliba,Thomas,Tierney,Tomiyasu,Trossard,White,Zinchenko,Neto,Sterling,Calafiori,Lewis-Skelly,Merino,Oulad M'hand,Setford,Kacurri,Kabia,Nichols,Butler-Oyedeji,Arteta,Porter,Bailey,Barkley,Barrenechea,Buendia,Cash,Dendoncker,Diaby,Diego Carlos,Digne,Dobbin,Duran,Gauci,Hause,Iling Jr,Kamara,Kesler-Hayden,Konsa,Maatsen,Marschall,Martinez,McGinn,Mings,Nedeljkovic,Olsen,Pau,Ramsey,Rogers,Sinisalo,Sousa,Tielemans,Watkins,Disasi,Onana,Rashford,Bogarde,Swinkels,Zych,Young,Broggio,Jimoh,Malen,A. Garcia,Emery,M.Asensio,Aarons,Adams,Anthony,Brooks,Christie,Cook,Enes Ünal,Faivre,H.Traorè,Hill,Jebbison,Kerkez,Kluivert,Mepham,O.Dango,Paulsen,Philip,Scott,Semenyo,Senesi,Sinisterra,Smith,Tavernier,Travers,Zabarnyi,Arrizabalaga,Huijsen,J.Araujo,Dennis,Evanilson,Kinsey,Winterburn,Harris,Rees-Dottin,Akinmboni,Soler,Adu-Adjei,Sadi,McKenna,Silcott-Duberry,Iraola,Ajer,Brierley,Collins,Damsgaard,Dasilva,Flekken,Henry,Hickey,Janelt,Jensen,Ji-soo,Konak,Lewis-Potter,Mbeumo,Mee,Nørgaard,Onyeka,Peart-Harris,Pinnock,Roerslev,Schade,Thiago,Toney,Valdimarsson,Wissa,Yarmoliuk,Zanka,Carvalho,Van den Berg,Trevitt,G.Nunes,Meghoma,Yogane,Maghoma,Arthur,Frank,Kayode,Eyestone,Adingra,Baker-Boaitey,Baleba,Barco,Cozier-Duberry,Dahoud,Dunk,Estupiñan,Gilmour,Gross,Hinshelwood,I.Osman,Igor,João Pedro,Kozlowski,Lamptey,March,Mazilu,Milner,Minteh,Mitoma,Moder,O’Mahony,Offiah,Peupion,Sarmiento,Steele,Undav,Van Hecke,Veltman,Verbruggen,Webster,Welbeck,Wieffer,Gruda,Ayari,Moran,Rushworth,Georginio,F.Kadıoğlu,O'Riley,Samuels,Cahill,McConville,Slater,Gómez,Hürzeler,Knight,Cashin,Andrey Santos,Ângelo,B.Badiashile,Bergström,Bettinelli,Caicedo,Casadei,Chalobah,Chukwuemeka,Colwill,Cucurella,D.D.Fofana,Deivid,Dewsbury-Hall,Enzo,Gallagher,Gilchrist,Gusto,James,Kellyman,Lavia,Lukaku,M.Sarr,Madueke,Marc Guiu,Mudryk,N.Jackson,Nkunku,Palmer,Petrović,Renato Veiga,Sánchez,Tosin,W.Fofana,Sancho,Neto,Wiley,Jørgensen,João Félix,Rak-Sakyi,George,Acheampong,Maresca,Amougou,Anselmino,Nketiah,Chilwell,Ahamada,C.Doucouré,C.Richards,Chadi Riad,Clyne,Ebiowei,Eze,Guéhi,Henderson,Holding,Hughes,Kamada,Lerma,Mateta,M.França,Matthews,Mitchell,Muñoz,Ozoh,Rak-Sakyi,Schlupp,Ward,Wharton,Turner,I.Sarr,Umeh-Chibueze,Devenny,Agbinone,Rodney,Lacroix,Kporha,Marsh,Esse,Glasner,Broja,A.Doucoure,Beto,Branthwaite,Calvert-Lewin,Coleman,Gana,Garner,Harrison,Holgate,Iroegbunam,J.Virginia,Keane,Maupay,McNeil,Mykolenko,Ndiaye,Patterson,Pickford,Tarkowski,Y. Chermiti,Young,Alcaraz,Lindstrøm,O'Brien,Armstrong,Metcalfe,Begovic,Dixon,Mangala,Bates,Sherif,Moyes,Heath,Coby Ebere,Nelson,Smith Rowe,Andersen,Adama,Andreas,Bassey,Benda,Cairney,Castagne,Diop,Harris,Iwobi,Leno,Lukić,Mbabu,Muniz,Raúl,Ream,Reed,Robinson,Stansfield,Tete,Vinicius,Wilson,Sessegnon,J.Cuenca,King,Godo,Berge,Amissah,Silva,Willian,Enciso,Al-Hamadi,Baggott,Broadhead,Burgess,Burns,Chaplin,H.Clarke,Davis,Delap,Edmundson,Greaves,Harness,Hirst,Humphreys,Hutchinson,Johnson,Ladapo,Luongo,Morsy,Ndaba,Slicker,Taylor,Tuanzebe,Walton,Woolfenden,Phillips,Muric,Jaden,Townsend,Szmodics,Cajuste,O'Shea,J.Clarke,Ogbene,Godfrey,McKenna,Palmer,Buonanotte,J.Ayew,Edouard,B.Soumaré,Cannon,Choudhury,Coady,Daka,De Cordova-Reid,Faes,Golding,Hermansen,Iversen,Justin,Kristiansen,Marcal,Mavididi,McAteer,Ndidi,Okoli,Ricardo,Souttar,Stolarczyk,Thomas,Vardy,Vestergaard,Ward,Winks,Skipp,A.Fatawu,Alves,Nelson,El Khannouss,Cartwright,Wilson-Brown,Coulibaly,Van Nistelrooy,A.Becker,Alexander-Arnold,Bajcetic,Bradley,Clark,Darwin,Diogo J.,Doak,Elliott,Endo,Gakpo,Gomez,Gravenberch,Jones,Kelleher,Konaté,Luis Díaz,M.Salah,Mac Allister,McConnell,Morton,N.Phillips,Quansah,R.Williams,Robertson,Szoboszlai,Tsimikas,Virgil,Chiesa,Jaros,Davies,Nyoni,Nallo,Danns,Slot,Akanji,Aké,Bernardo,Bobb,Carson,De Bruyne,Doku,Ederson M.,Foden,Grealish,Gvardiol,Haaland,J.Alvarez,João Cancelo,Kovačić,Lewis,Matheus N.,McAtee,Ortega Moreno,Rodrigo,Rúben,Stones,Walker,Savinho,O’Reilly,Gündogan,Kaboré,Wright,Simpson-Pusey,Wilson-Esbrand,Mubama,Alleyne,Brits,Khusanov,Vitor Reis,Guardiola,Marmoush,N.Gonzalez,Amad,Antony,B.Fernandes,Bayindir,Casemiro,Dalot,Eriksen,Evans,Garnacho,Hannibal,Heaton,Højlund,Lindelof,Maguire,Mainoo,Malacia,Martinez,McTominay,Mount,Onana,Pellistri,Shaw,Zirkzee,Yoro,De Ligt,Mazraoui,Collyer,Wheatley,Ugarte,Heaven,Fletcher,Amass,Fitzgerald,Kukonki,Amorim,Harrison,Dorgu,Obi,Fredricson,Moorhouse,Koné,A.Murphy,Almirón,Barnes,Botman,Bruno G.,Burn,Dúbravka,Gordon,Hall,Hayden,Isak,J.Murphy,Joelinton,Kelly,Krafth,Kuol,Lascelles,Lewis,Livramento,Longstaff,Miley,Odysseas,Pope,Ruddy,Schär,Targett,Tonali,Trippier,White,Willock,Wilson,Pivas,Osula,Howe,Alex Moreno,Aina,Anderson,Awoniyi,Boly,Bowler,C.Miguel,Da Silva Moreira,Danilo,Dennis,Dominguez,Elanga,Gibbs-White,Hudson-Odoi,Mighten,Murillo,N.Williams,O.Richards,O'Brien,Omobamidele,Panzo,Sangaré,Sels,Toffolo,Ui-jo,Wood,Worrall,Yates,Milenković,Jota Silva,Sosa,Morato,Abbott,Hennessey,Nuno,Ramsdale,Archer,Ugochukwu,Fraser,Amo-Ameyaw,Aribo,Armstrong,Bazunu,Bednarek,Bella-Kotchap,Bree,Charles,Edozie,Edwards,Harwood-Bellis,Kamaldeen,Lallana,Larios,Lis,Lumley,Manning,Mara,McCarthy,Onuachu,Smallbone,Stephens,Stewart,Sugawara,Taylor,Walker-Peters,Wood,Cornet,Downes,Brereton Díaz,Dibling,M.Fernandes,O'Brien-Whitmarsh,Welington,Kayi Sanda,Grønbæk,Jurić,Solanke,A.Phillips,Austin,Bentancur,Bergvall,Bissouma,Bryan,Davies,Devine,Dragusin,E.Royal,Forster,Gray,Højbjerg,Johnson,Kulusevski,Lo Celso,Maddison,Pedro Porro,Reguilón,Richarlison,Romero,P.M.Sarr,Scarlett,Solomon,Son,Spence,Udogie,Van de Ven,Veliz,Vicario,Werner,Whiteman,Lankshear,Moore,Odobert,Olusesi,Hardy,Williams-Barnett,Dorrington,King,Kinsky,Yang,Ajayi,Postecoglou,Cassanova,Danso,Tel,Ferguson,Wan-Bissaka,Álvarez,Antonio,Areola,Bowen,Coufal,Cresswell,Earthy,Emerson,Fabianski,Foderingham,Ings,Kilman,Kudus,L.Guilherme,L.Paquetá,Mavropanos,N.Aguerd,Souček,Ward-Prowse,Zouma,Irving,Summerville,G.Rodríguez,Füllkrug,Todibo,Casey,C.Soler,Scarles,Mayers,Orford,Potter,Johnstone,Aït-Nouri,B.Traore,Bellegarde,Bentley,Chiquinho,Chirewa,Chiwome,Cundle,Cunha,Dawson,Doherty,Doyle,Fábio Silva,Fraser,Gonzalez,Guedes,H.Bueno,Hee Chan,Hodge,Hoever,J.Gomes,José Sá,Kalajdžić,King,Mario Jr.,Mosquera,N.Semedo,Pedro Lima,Podence,R.Gomes,S.Bueno,Sarabia,Strand Larsen,Toti,Meupiyou,André,Forbs,Pond,Edozie,Okoduwa,Agbadou,Pereira,Djiga,Munetsi`;
// const csvData = `salah,haaland,isak,palmer,wood,mbeumo`;

// Replace all full stops with spaces, as Firebase will not accept a string with any of ".", "#", "$", "[", or "]"
const player_names_with_spaces = player_names_with_full_stops.replace(/\./g, ' ');

// Function to parse the names data and populate the datalist
function load_player_names() {
    try {
        // Parse the names data (split by commas)
        const captains = player_names_with_spaces.split(',').map(name => name.trim()); // Trim whitespace from each name

        // Get the datalist element
        const datalist = document.getElementById('captains');

        // Populate the datalist with options
        captains.forEach(captain => {
            if (captain) { // Ensure the captain name is not empty
                const option = document.createElement('option');
                option.value = captain;
                datalist.appendChild(option);
            }
        });
    } catch (error) {
        console.error('Error parsing captains data:', error);
    }
}

// Call the functions to load captains when the page loads
load_player_names();

// this shows or hides the captaincy input field based on radio button for playing_this_week
const yesPlayingRadio = document.getElementById('yes_playing');
const noPlayingRadio = document.getElementById('no_playing');
const captaincyInput = document.getElementById('captaincy_input');

if (yesPlayingRadio && noPlayingRadio && captaincyInput) {
    yesPlayingRadio.addEventListener('change', function() {
        if (this.checked) {
            captaincyInput.style.display = 'block';
        }
    });
    
    noPlayingRadio.addEventListener('change', function() {
        if (this.checked) {
            captaincyInput.style.display = 'none';
        }
    });
} else {
    console.error("One or more elements are missing in the DOM.");
}

const yesWatchRadio = document.getElementById('yes_watch');
const noWatchRadio = document.getElementById('no_watch');
const time_watching_input = document.getElementById('time_watching_input');

if (yesWatchRadio && noWatchRadio && time_watching_input) {
    yesWatchRadio.addEventListener('change', function() {
        if (this.checked) {
            time_watching_input.style.display = 'block';
        }
    });
    
    noWatchRadio.addEventListener('change', function() {
        if (this.checked) {
            time_watching_input.style.display = 'none';
        }
    });
} else {
    console.error("One or more elements are missing in the DOM.");
}

// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyDttowksX0CuiezjcjmgdTSSIYmxAW-EW8",
    authDomain: "lc-comp-sci-project.firebaseapp.com",
    databaseURL: "https://lc-comp-sci-project-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "lc-comp-sci-project",
    storageBucket: "lc-comp-sci-project.firebasestorage.app",
    messagingSenderId: "1095647242652",
    appId: "1:1095647242652:web:c690671b3db08dfa4a8059",
    measurementId: "G-XC2FPV1FBP"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

async function updateCharts() {
    // Use Promise.all to ensure all data is loaded before updating charts
    const [teamsSnapshot, teamsTotalSnapshot, playingSnapshot, playingTotalSnapshot, captainSnapshot, captainTotalSnapshot, watchingSnapshot,watchingTotalSnapshot, years_watchingSnapshot, years_watchingTotalSnapshot] = await Promise.all([
        firebase.database().ref('teams').once('value'),
        firebase.database().ref('teams-total').once('value'),
        firebase.database().ref('playing-this-week').once('value'),
        firebase.database().ref('playing-this-week-total').once('value'),
        firebase.database().ref('selected-captain').once('value'),
        firebase.database().ref('selected-captain-total').once('value'),
        firebase.database().ref('watching').once('value'),
        firebase.database().ref('watching-total').once('value'),
        firebase.database().ref('years-watching').once('value'),
        firebase.database().ref('years-watching-total').once('value'),
    ]);

    const teamsData = teamsSnapshot.val();
    const teamsTotalData = teamsTotalSnapshot.val();
    const playingData = playingSnapshot.val();
    const playingTotalData = playingTotalSnapshot.val();
    const captainData = captainSnapshot.val();
    const captainTotalData = captainTotalSnapshot.val();

    const totalTeams = teamsTotalData ? teamsTotalData.count : 0;
    const totalPlaying = playingTotalData ? playingTotalData.count : 0;
    const totalCaptains = captainTotalData ? captainTotalData.count : 0;


    function updatePieChart(data, total, chartFunc, chartId) {
        if (total > 0) {
            const labels = Object.keys(data);
            const dataValues = Object.values(data).map(item => item.count);
            const percentageLabels = dataValues.map(count => `${((count / total) * 100).toFixed(2)}%`);
            chartFunc(labels, dataValues, percentageLabels, chartId);
        } else {
            console.log(`Total count for ${chartId} is 0`);
        }
    }

    updatePieChart(teamsData, totalTeams, createTeamsPieChart, 'favourite_team_chart');
    updatePieChart(playingData, totalPlaying, createPlayingPieChart, 'playing_this_week_chart');
    updatePieChart(captainData, totalCaptains, createCaptainPieChart, 'captains_chart');
}


const form = document.getElementById('user_data');
form.addEventListener('submit', (e) => {
    e.preventDefault(); // Prevent default form submission

    const favourite_team = document.getElementById('favourite_team').value;
    
    const user_rating_radios = document.querySelectorAll('input[name="user_rating"]');
    let user_rating = null;

    user_rating_radios.forEach(radio => {
        if (radio.checked) {
            user_rating = radio.value;
        }
    });

    const watching_radios = document.querySelectorAll('input[name="watching"]');
    let watching = null;

    watching_radios.forEach(radio => {
        if (radio.checked) {
            watching = radio.value;
        }
    });

    const years_watching = document.getElementById('years_watching').value;

    const playing_radios = document.querySelectorAll('input[name="playing_this_week"]');
    let playing_this_week = null;

    playing_radios.forEach(radio => {
        if (radio.checked) {
            playing_this_week = radio.value;
        }
    });

    const captain = document.getElementById('captain').value;

    const teamRef = database.ref(`teams/${favourite_team}/count`);
    const teamTotalRef = database.ref(`teams-total/count`);
    const ratingRef = database.ref(`user-rating/${user_rating}/count`);
    const ratingTotalRef = database.ref(`user-rating-total/count`);
    const watchingRef = database.ref(`watching/${watching}/count`);
    const watchingTotalRef = database.ref(`watching-total/count`);
    const years_watchingRef = database.ref(`years-watching/${years_watching}/count`);
    const years_watchingTotalRef = database.ref(`years-watching-total/count`);
    const playingRef = database.ref(`playing-this-week/${playing_this_week}/count`);
    const playingTotalRef = database.ref(`playing-this-week-total/count`);
    const captainRef = database.ref(`selected-captain/${captain}/count`);
    const captainTotalRef = database.ref(`selected-captain-total/count`);

    // a new data entry entered every time the form is submitted
    const newData = {
        favourite_team: favourite_team,
        user_rating: user_rating,
        watching: watching,
        years_watching: years_watching,
        playing_this_week: playing_this_week,
        captain: captain
    };

    // here I'm updating the team count using a transaction
    teamRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Team count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating  team count:', error);
    });
    teamTotalRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Team total count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating team total count:', error);
    });

    // here I'm updating the rating count using a transaction
    ratingRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Rating count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating  rating count:', error);
    });
    ratingTotalRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Rating total count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating rating total count:', error);
    });

    // here I'm updating the watching count using a transaction
    watchingRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Watching count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating  watching count:', error);
    });
    watchingTotalRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('watching total count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating watching total count:', error);
    });

    if (years_watching !== null && years_watching !== "") {
        // here I'm updating the years_watching count using a transaction
        years_watchingRef.transaction((currentCount) => {
            return (currentCount || 0) + 1;
        }).then(() => {
            console.log('Years watching count updated successfully!');
            form.reset();
        }).catch((error) => {
            console.error('Error updating years_watching count:', error);
        });

        // here I'm updating the years_watching total count using a transaction
        years_watchingTotalRef.transaction((currentCount) => {
            return (currentCount || 0) + 1;
        }).then(() => {
            console.log('Years watching total count updated successfully!');
            form.reset();
        }).catch((error) => {
            console.error('Error updating years watching total count:', error);
        });
    } else {
        console.log('Years watching value is null. Transactions skipped.');
    }

    // here I'm updating the playing-this-week count using a transaction
    playingRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Playing this week count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating playing this week count:', error);
    });
    playingTotalRef.transaction((currentCount) => {
        return (currentCount || 0) + 1;
    }).then(() => {
        console.log('Playing this week total count updated successfully!');
        form.reset();
    }).catch((error) => {
        console.error('Error updating playing this week total count:', error);
    });

    // I'm ensuring that the value of captain is not empty, otherwise this will still push data to firebase, but in the form of an entry directly in the node "selected-captain"
    // without this, it messes with the pie charts I have at the bottom of the page, adding in a slice that isn't supposed to be there
    // the slice is called "count" and appears alongside the names of captains
    if (captain !== null && captain !== "") {
        // here I'm updating the captain count using a transaction
        captainRef.transaction((currentCount) => {
            return (currentCount || 0) + 1;
        }).then(() => {
            console.log('Captain count updated successfully!');
            form.reset();
        }).catch((error) => {
            console.error('Error updating captain count:', error);
        });

        // here I'm updating the captain total count using a transaction
        captainTotalRef.transaction((currentCount) => {
            return (currentCount || 0) + 1;
        }).then(() => {
            console.log('Captain total count updated successfully!');
            form.reset();
        }).catch((error) => {
            console.error('Error updating captain total count:', error);
        });
    } else {
        console.log('Captain value is null. Transactions skipped.');
    }

    // Write the data to Firebase
    database.ref('user_data').push().set(newData)
        .then(() => {
            console.log('Data successfully written!');
            form.reset(); // Clear the form after successful submission
        })
        .catch((error) => {
            console.error('Error writing data:', error);
        }); 
    setTimeout(() => updateCharts(), 500); // Adjust the delay as needed
});



function createStripedPattern(colour1, colour2) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  // Set canvas size
  canvas.width = 10; // Width of the pattern
  canvas.height = 10; // Height of the pattern

  // Fill with the first color
  ctx.fillStyle = colour1;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw vertical stripes with the second color
  ctx.strokeStyle = colour2;
  ctx.lineWidth = 10/3 ; // Adjust the stripe thickness
  ctx.beginPath();
  ctx.moveTo(5, 0); // Start at the middle of the top edge
  ctx.lineTo(5, canvas.height); // Draw a vertical line to the bottom edge
  ctx.stroke();

  return ctx.createPattern(canvas, 'repeat');
}

let myTeamsChart = null; // Variable to store the chart instance

// Listen for changes in the database
const teamsRef = database.ref('teams');
const teamsTotalRef = database.ref('teams-total');

teamsRef.on('value', (snapshot) => {
    const data = snapshot.val();
    if (data) {
        // Fetch the total count from the 'teams-total' node
        teamsTotalRef.once('value').then((totalSnapshot) => {
            const totalData = totalSnapshot.val();
            const total = totalData ? totalData.count : 0; // Extract the 'count' key

            if (total && total > 0) {
                const labels = Object.keys(data);
                const dataValues = Object.values(data).map(teamData => teamData.count);

                // Calculate percentages of the total
                const percentageLabels = dataValues.map(count => `${((count / total) * 100).toFixed(2)}%`); // Calculate percentage and add '%'

                // Destroy the existing chart and create a new one with percentage labels
                createTeamsPieChart(labels, dataValues, percentageLabels);
            } else {
                console.log("Total count is missing or invalid.");
            }
        }).catch((error) => {
            console.error("Error fetching total count:", error);
        });
    } else {
        console.log("No data found.");
    }
});

function createTeamsPieChart(labels, dataValues, percentageLabels) {
    const ctx = document.getElementById('favourite_team_chart').getContext('2d');

    // Destroy the existing chart if it exists
    if (myTeamsChart) {
        myTeamsChart.destroy();
    }

    // Define striped patterns for the chart
    const team_colours = [
        '#EF0107', 
        createStripedPattern('#850322', '#88BBFF'), 
        createStripedPattern('#BC0F14', '#000000'), 
        createStripedPattern('#E30613', '#FFFFFF'), 
        createStripedPattern('#005DAA', '#FFFFFF'), 
        '#034694',
        createStripedPattern('#1B458F', '#C4122E'),
        '#274488',
        '#E5CBCB',
        '#3A64A3',
        '#0101E8',
        '#B21313',
        '#97C1E7',
        createStripedPattern('#E80909', '#FFE500'),
        createStripedPattern('#000000', '#FFFFFF'),
        '#E53233',
        createStripedPattern('#ED1A3B', '#FFFFFF'),
        '#CCCCCC',
        createStripedPattern('#7C2C3B', '#000000'),
        createStripedPattern('#FDB913', '#231F20')
    ];

    // Create a new chart
    myTeamsChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels.map((label, index) => `${label} (${percentageLabels[index]})`), // Append percentage to label
            datasets: [{
                data: dataValues,
                backgroundColor: team_colours,
                hoverOffset: 4
            }]
        },
        options: { 
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Favourite Teams'
                }
            }
        }
    });
}


let myPlayingChart = null;

// Listen for changes in the database
const playing_this_week_Ref = database.ref('playing-this-week');
const playing_this_week_total_Ref = database.ref('playing-this-week-total');

playing_this_week_Ref.on('value', (snapshot) => {
    const data = snapshot.val();
    if (data) {
        // Fetch the total count from the 'playing-this-week-total' node
        playing_this_week_total_Ref.once('value').then((totalSnapshot) => {
            const totalData = totalSnapshot.val();
            const total = totalData ? totalData.count : 0; // Extract the 'count' key

            if (total && total > 0) {
                const labels = Object.keys(data);
                const dataValues = Object.values(data).map(playingData => playingData.count);

                // Calculate percentages of the total
                const percentageLabels = dataValues.map(count => `${((count / total) * 100).toFixed(2)}%`); // Calculate percentage and add '%'

                // Destroy the existing chart and create a new one with percentage labels
                createPlayingPieChart(labels, dataValues, percentageLabels);
            } else {
                console.log("Total count is missing or invalid.");
            }
        }).catch((error) => {
            console.error("Error fetching total count:", error);
        });
    } else {
        console.log("No data found.");
    }
});

function createPlayingPieChart(labels, dataValues, percentageLabels) {
    const ctx = document.getElementById('playing_this_week_chart').getContext('2d');

    // Destroy the existing chart if it exists
    if (myPlayingChart) {
        myPlayingChart.destroy();
    }

    // Create a new chart
    myPlayingChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels.map((label, index) => `${label} (${percentageLabels[index]})`), // Append percentage to label
            datasets: [{
                data: dataValues,
                backgroundColor: ['#FF0000', '#00FF00'],
                hoverOffset: 4
            }]
        },
        options: { 
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Playing This Week?'
                }
            }
        }
    });
}
let myCaptainsChart = null;

// Listen for changes in the database
const captain_Ref = database.ref('selected-captain');
const captain_total_Ref = database.ref('selected-captain-total');

captain_Ref.on('value', (snapshot) => {
    const data = snapshot.val();
    if (data) {
        // Fetch the total count from the 'selected-captain-total' node
        captain_total_Ref.once('value').then((totalSnapshot) => {
            const totalData = totalSnapshot.val();
            const total = totalData ? totalData.count : 0; // Extract the 'count' key

            if (total && total > 0) {
                const labels = Object.keys(data);
                const dataValues = Object.values(data).map(captainData => captainData.count);

                // Calculate percentages of the total
                const percentageLabels = dataValues.map(count => `${((count / total) * 100).toFixed(2)}%`); // Calculate percentage and add '%'

                // Destroy the existing chart and create a new one with percentage labels
                createCaptainPieChart(labels, dataValues, percentageLabels);
            } else {
                console.log("Total count is missing or invalid.");
            }
        }).catch((error) => {
            console.error("Error fetching total count:", error);
        });
    } else {
        console.log("No data found.");
    }
});

function createCaptainPieChart(labels, dataValues, percentageLabels) {
    const ctx = document.getElementById('captains_chart').getContext('2d');

    // Destroy the existing chart if it exists
    if (myCaptainsChart) {
        myCaptainsChart.destroy();
    }

    // Create a new chart
    myCaptainsChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels.map((label, index) => `${label} (${percentageLabels[index]})`), // Append percentage to label
            datasets: [{
                data: dataValues,
                hoverOffset: 4
            }]
        },
        options: { 
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Selected Captains'
                }
            }
        }
    });
}